<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://jqwidgets.com/public/jqwidgets/styles/jqx.base.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcore.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdata.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxbuttons.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxscrollbar.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxmenu.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdata.export.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.js"></script>  
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.filter.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.edit.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.sort.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.selection.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.export.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.storage.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcombobox.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.pager.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.grouping.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.aggregates.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.columnsresize.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.columnsreorder.js"></script> 

	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxwindow.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/globalization/globalize.js"></script> 
	
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxlistbox.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdropdownlist.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdraw.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxchart.core.js"></script>

	 
	 
	
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdatetimeinput.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdate.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxslider.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxpanel.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxinput.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdragdrop.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcalendar.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxtree.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxinput.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxexport.js"></script> 
	 


<script type="text/javascript" src="/shared/js/shared-scripts.js"></script>

	<script type="text/javascript" src="/shared/js/internal-scripts.js"></script> 
	<script type="text/javascript" src="/shared/js/vocabulary_scripts.js"></script>
	<script type="text/javascript" src="/users/js/internal.js"></script>

	
	<script type="text/javascript" src="/annotations/js/annotations.js"></script>


 

<script type="text/javascript" src="/lib/misc/jquery-ui-multiselect-widget-3.0.0/src/jquery.multiselect.js"></script> 
<script type="text/javascript" src="/lib/misc/jquery-ui-multiselect-widget-3.0.0/src/jquery.multiselect.filter.js"></script>


<script type="text/javascript" src="/lib/misc/multizoom/multizoom.js"></script><style type="text/css">.featuredimagezoomerhidden {visibility: hidden!important;}</style>
<link rel="stylesheet" href="/lib/misc/multizoom/multizoom.css">


	<script type="text/javascript" src="/specimens/js/search.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcheckbox.js"></script>
	<script type="text/javascript" src="/specimens/js/specimens.js"></script>

	<script type="text/javascript" src="/shared/js/tabs.js"></script>

	<script type="text/javascript" src="/transactions/js/transactions.js"></script>

	<script type="text/javascript" src="/taxonomy/js/taxonomy.js"></script>
</head>
<body>
	<cfset action = 'fixedSearch'>
	<div id="overlaycontainer" style="position: relative;">
		<main id="content" class="container-fluid">
			<div class="row mr-0 mr-md-3 mr-xl-5">
				<div class="col-12 mt-1 pb-3 mr-0 mr-md-3 mr-xl-5">
					<cfquery name="getSpecimenCount" datasource="user_login" username="#session.dbuser#" password="#decrypt(session.epw,cookie.cfid)#">
						SELECT count(collection_object_id) as cnt FROM cataloged_item
					</cfquery>
					
					<h1 class="h3 smallcaps mb-1 pl-3">Find Specimen Records <span class="count  font-italic color-green mx-0"><small> #getSpecimenCount.cnt# records</small><small class="sr-only">Tab into search form</small></span></h1>
					<!--- populated with download dialog for external users --->
					<div id="downloadAgreeDialogDiv"></div>
					<!--- Tab header div --->
					<div class="tabs card-header tab-card-header px-2 pt-3">
						<cfswitch expression="#action#">
							<cfcase value="fixedSearch">
								<cfset fixedTabActive = "active">
								<cfset fixedTabShow = "">
								<cfset keywordTabActive = "">
								<cfset keywordTabShow = "hidden">
								<cfset builderTabActive = "">
								<cfset builderTabShow = "hidden">
								<cfset fixedTabAria = "aria-selected=""true"" tabindex=""0"" ">
								<cfset keywordTabAria = "aria-selected=""false"" tabindex=""-1"" ">
								<cfset builderTabAria = "aria-selected=""false"" tabindex=""-1"" ">
							</cfcase>
							<cfcase value="keywordSearch">
								<cfset fixedTabActive = "">
								<cfset fixedTabShow = "hidden">
								<cfset keywordTabActive = "active">
								<cfset keywordTabShow = "">
								<cfset builderTabActive = "">
								<cfset builderTabShow = "hidden">
								<cfset fixedTabAria = "aria-selected=""false"" tabindex=""-1"" ">
								<cfset keywordTabAria = "aria-selected=""true"" tabindex=""0"" ">
								<cfset builderTabAria = "aria-selected=""false"" tabindex=""-1"" ">
							</cfcase>
							<cfcase value="builderSearch">
								<cfset fixedTabActive = "">
								<cfset fixedTabShow = "hidden">
								<cfset keywordTabActive = "">
								<cfset keywordTabShow = "hidden">
								<cfset builderTabActive = "active">
								<cfset builderTabShow = "">
								<cfset fixedTabAria = "aria-selected=""false"" tabindex=""-1"" ">
								<cfset keywordTabAria = "aria-selected=""false"" tabindex=""-1"" ">
								<cfset builderTabAria = "aria-selected=""true"" tabindex=""0"" ">
							</cfcase>
							<cfdefaultcase>
								<cfset fixedTabActive = "active">
								<cfset fixedTabShow = "">
								<cfset keywordTabActive = "">
								<cfset keywordTabShow = "hidden">
								<cfset builderTabActive = "">
								<cfset builderTabShow = "hidden">
								<cfset fixedTabAria = "aria-selected=""true"" tabindex=""0"" ">
								<cfset builderTabAria = "aria-selected=""false"" tabindex=""-1"" ">
								<cfset keywordTabAria = "aria-selected=""false"" tabindex=""-1"" ">
							</cfdefaultcase>
						</cfswitch>
				
						<div class="tab-headers px-0 tabList" role="tablist" aria-label="search panel tabs">
							<button class="col-3 col-md-2 px-2 my-0 #fixedTabActive#" id="basicSearchTabButton" tabid="1" role="tab" aria-controls="fixedSearchPanel" #fixedTabAria#>Basic Search</button>
							<button class="col-3 col-xl-2 px-1 my-0 #keywordTabActive#" id="keywordSearchTabButton" tabid="2" role="tab" aria-controls="keywordSearchPanel" #keywordTabAria# >Keyword Search</button>
							<button class="col-3 col-xl-2 px-1 my-0 #builderTabActive#" id="builderSearchTabButton" tabid="3" role="tab" aria-controls="builderSearchPanel" #builderTabAria# aria-label="search builder tab">Search Builder</button>
						</div>
						<div class="tab-content mt-0 px-0 pb-0">
							<!---Fixed Search tab panel--->
							<script type="text/javascript" language="javascript">
							function toggleIDDetail(onOff) {
								if (onOff==0) {
									$("##IDDetail").hide();
									$("##IDDetailCtl").attr('onCLick','toggleIDDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="more fields"></i></span>');
									$("##IDDetailCtl1").attr('onCLick','toggleIDDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="more fields"></i></span>');
								} else {
									$("##IDDetail").show();
									$("##IDDetailCtl").attr('onCLick','toggleIDDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="fewer fields"></i></span>');
									$("##IDDetailCtl1").attr('onCLick','toggleIDDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="fewer fields"></i></span>');
								}
								<cfif isdefined("session.username") and len(#session.username#) gt 0>
									jQuery.getJSON("/specimens/component/search.cfc",
										{
											method : "saveBasicSrchPref",
											id : 'IDDetail',
											onOff : onOff,
											returnformat : "json",
											queryformat : 'column'
										}, 
										function (data) { 
											console.log(data);
										}
									).fail(function(jqXHR,textStatus,error){
										handleFail(jqXHR,textStatus,error,"persisting IDDetail state");
									});
								</cfif>
							}
							function toggleTaxaDetail(onOff) {
								if (onOff==0) {
									$("##TaxaDetail").hide();
									$("##TaxaDetailCtl").attr('onCLick','toggleTaxaDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
									$("##TaxaDetailCtl1").attr('onCLick','toggleTaxaDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
								} else {
									$("##TaxaDetail").show();
									$("##TaxaDetailCtl").attr('onCLick','toggleTaxaDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
									$("##TaxaDetailCtl1").attr('onCLick','toggleTaxaDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
								}
								<cfif isdefined("session.username") and len(#session.username#) gt 0>
									jQuery.getJSON("/specimens/component/search.cfc",
										{
											method : "saveBasicSrchPref",
											id : 'TaxaDetail',
											onOff : onOff,
											returnformat : "json",
											queryformat : 'column'
										},
										function (data) { 
											console.log(data);
										}
									).fail(function(jqXHR,textStatus,error){
										handleFail(jqXHR,textStatus,error,"persisting TaxaDetail state");
									});
								</cfif>
							}
							function toggleGeogDetail(onOff) {
								if (onOff==0) {
									$("##GeogDetail").hide();
									$("##GeogDetailCtl").attr('onCLick','toggleGeogDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
									$("##GeogDetailCtl1").attr('onCLick','toggleGeogDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
								} else {
									$("##GeogDetail").show();
									$("##GeogDetailCtl").attr('onCLick','toggleGeogDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
									$("##GeogDetailCtl1").attr('onCLick','toggleGeogDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
								}
								<cfif isdefined("session.username") and len(#session.username#) gt 0>
									jQuery.getJSON("/specimens/component/search.cfc",
										{
											method : "saveBasicSrchPref",
											id : 'GeogDetail',
											onOff : onOff,
											returnformat : "json",
											queryformat : 'column'
										},
										function (data) { 
											console.log(data);
										}
									).fail(function(jqXHR,textStatus,error){
										handleFail(jqXHR,textStatus,error,"persisting GeogDetail state");
									});
								</cfif>
							}
							function toggleCollDetail(onOff) {
								if (onOff==0) {
									$("##CollDetail").hide();
									$("##CollDetailCtl").attr('onCLick','toggleCollDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
									$("##CollDetailCtl1").attr('onCLick','toggleCollDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
								} else {
									$("##CollDetail").show();
									$("##CollDetailCtl").attr('onCLick','toggleCollDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
									$("##CollDetailCtl1").attr('onCLick','toggleCollDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
								}
								<cfif isdefined("session.username") and len(#session.username#) gt 0>
									jQuery.getJSON("/specimens/component/search.cfc",
										{
											method : "saveBasicSrchPref",
											id : 'CollDetail',
											onOff : onOff,
											returnformat : "json",
											queryformat : 'column'
										},
										function (data) { 
											console.log(data);
										}
									).fail(function(jqXHR,textStatus,error){
										handleFail(jqXHR,textStatus,error,"persisting CollDetail state");
									});
								</cfif>
							}
							function toggleSpecDetail(onOff) {
								if (onOff==0) {
									$("##SpecDetail").hide();
									$("##SpecDetailCtl").attr('onCLick','toggleSpecDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
									$("##SpecDetailCtl1").attr('onCLick','toggleSpecDetail(1)').html('<span class="btn-link">show more <i class="fas fa-caret-down" style="vertical-align: middle;" title="show more fields"></i></span>');
								} else {
									$("##SpecDetail").show();
									$("##SpecDetailCtl").attr('onCLick','toggleSpecDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
									$("##SpecDetailCtl1").attr('onCLick','toggleSpecDetail(0)').html('<span class="btn-link">show less <i class="fas fa-caret-right" style="vertical-align: middle;" title="show fewer fields"></i></span>');
								}
								<cfif isdefined("session.username") and len(#session.username#) gt 0>
									jQuery.getJSON("/specimens/component/search.cfc",
										{
											method : "saveBasicSrchPref",
											id : 'SpecDetail',
											onOff : onOff,
											returnformat : "json",
											queryformat : 'column'
										},
										function (data) { 
											console.log(data);
										}
									).fail(function(jqXHR,textStatus,error){
										handleFail(jqXHR,textStatus,error,"persisting SpecDetail state");
									});
								</cfif>
							}
						</script>
							<!---Keyword Search/results tab panel--->
							<section id="keywordSearchPanel" role="tabpanel" aria-labelledby="keywordSearchTabButton" tabindex="-1" class="unfocus mx-0 #keywordTabActive# " #keywordTabShow#>
								<div class="col-9 float-right px-0"> 
									<button class="btn btn-xs btn-dark help-btn" type="button" data-toggle="collapse" data-target="##collapseKeyword" aria-expanded="false" aria-controls="collapseKeyword">
													Search Help
									</button>
									<aside class="collapse collapseStyle" id="collapseKeyword">
										<div class="card card-body pl-4 py-3 pr-3">
											<h2 class="headerSm">Keyword Search Help</h2>
											<p>
												This help applies only the keyword search, behavior and operators for other searches are different.
												<cfif isdefined("session.roles") and listfindnocase(session.roles,"coldfusion_user")> 
													(See: <a href="https://code.mcz.harvard.edu/wiki/index.php/Search_Operators" target="_blank">Search Operators</a>). For more examples, see: <a href="https://code.mcz.harvard.edu/wiki/index.php/Keyword_Search" target="_blank">Keyword Search</a>.
												</cfif>
											</p>
											<dl class="mb-0"> 
												<dt><span class="text-info font-weight-bold">&nbsp;</span></dt>
												<dd>When words are separated by spaces they form a phrase and it is this phrase which is searched for, not the individual words.  For example <em>Panama Bay</em> searches for those two words found adjacent to each other (ignoring punctuation and capitalization). Use operators such as <em>Panama &amp; Bay</em> or <em>NEAR((Panama,Bay),3)</em>, described below, to find a broader scope of records. </dd>
											</dl>
											<h2 class="headerSm">Keyword Search Operators</h2>
											<dl class="mb-0"> 
												<dt><span class="text-info font-weight-bold">&amp;</span></dt>
												<dd>The "and" operator, matches records where the search terms on both sides of the &amp; are present somewhere in the record.</dd>
												<dt><span class="text-info font-weight-bold">|</span></dt>
												<dd>The "or" operator, matches words where at least one of the search terms is present somewhere in the record.</dd>
												<dt><span class="text-info font-weight-bold">!</span></dt>
												<dd>The exclamation mark finds records that contain the first term but not the second (e.g., Panama ! Canal). Results returned would include "Panama" but not "Canal".</dd>
												<dt><span class="text-info font-weight-bold">NEAR((term,term2),distance) &nbsp;&nbsp;</span></dt>
												<dd>The NEAR((term,term2),distance) finds words that are nearby each other (e.g. NEAR((Panama,Bay),3) finds records where Panama and Bay are within three words of each other). Example of results: "San Miguel Id Bay of Panama" and "Bay of Panama, Dan Miguel Id".</dd>
												<dt><span class="text-info font-weight-bold">=</span></dt>
												<dd>The word equivalence operator, either word is interchangeable in the phrase (e.g., Taboga Island=Id). The results would return rows with "Taboga Island" or "Taboga Id".</dd>
												<dt><span class="text-info font-weight-bold">FUZZY(term) &nbsp;&nbsp;</span> </dt>
												<dd>This finds words that are a fuzzy match to the specified term, fuzzy matching can include variations (e.g. misspellings, typos) anywhere in the term (e.g., FUZZY(Taboga)).</dd>
												<dt><span class="text-info font-weight-bold">$</span></dt>
												<dd>The soundex symbol "$" finds words that sound like the specified term, unlike fuzzy matching, soundex tends to find words that are similar in the first few letters and vary at the end (e.g., $Rongelap finds records that contain words which sound like Rongelap. Soundex can be good for finding alternate endings on specific epithets of taxa).</dd>
												<dt><span class="text-info font-weight-bold">##</span></dt> 
												<dd>The stem operator finds words with the same linguistic stem as the search term, e.g. ##forest finds words with the same stem as forest such as forested or forests.</dd>
												<dt><span class="text-info font-weight-bold">( )</span></dt>
												<dd>Parentheses can be used to group terms for complex operations (e.g. Basiliscus &amp; (FUZZY(Honduras) | (Panama ! Canal)) will return results with a fuzzy match to Honduras, or Panama but not Canal).</dd>
												<dt><span class="text-info font-weight-bold">%</span></dt> 
												<dd>The percent wildcard, matches any number of characters, e.g. %bridge matches Cambridge, bridge, and Stockbridge.</dd>
												<dt><span class="text-info font-weight-bold">_</span> </dt><dd> The underscore wildcard, matches exactly one character and allows for any character to takes its place.</dd>
											</dl>
										</div>
									</aside>
								</div>
								<div role="search" id="keywordSearchFormDiv">
									<form name= "keywordSearchForm" id="keywordSearchForm" class="container-fluid">
										<input id="result_id_keywordSearch" type="hidden" name="result_id" value="" class="excludeFromLink">
										<input type="hidden" name="method" value="executeKeywordSearch" class="keeponclear excludeFromLink">
										<input type="hidden" name="action" value="keywordSearch" class="keeponclear">
										<div class="row mx-0">
											<div class="input-group mt-1">
												<div class="input-group-btn col-12 col-sm-5 col-md-5 col-xl-3 mb-1 mb-sm-0 pr-sm-0 pr-md-3">
													<label for="keywordCollection" class="data-entry-label">Limit to Collection(s)</label>
													<div name="collection_cde" id="keywordCollection" class="w-100 data-entry-select"></div>
													<cfif not isdefined("collection_cde")><cfset collection_cde=""></cfif>
													<cfset collection_array = ListToArray(collection_cde)>
													<script>
														function setKeywordCollectionValues() {
															$('##keywordCollection').jqxComboBox('clearSelection');
															<cfloop query="ctCollection">
																<cfif ArrayContains(collection_array, ctCollection.collection_cde)>
																	$("##keywordCollection").jqxComboBox("selectItem","#ctCollection.collection_cde#");
																</cfif>
															</cfloop>
														};
														$(document).ready(function () {
															var collectionsource = [
																<cfset comma="">
																<cfloop query="ctCollection">
																	#comma#{name:"#ctCollection.collection#",cde:"#ctCollection.collection_cde#"}
																	<cfset comma=",">
																</cfloop>
															];
															$("##keywordCollection").jqxComboBox({ source: collectionsource, displayMember:"name", valueMember:"cde", multiSelect: true, height: '24px', width: '100%' });
															setKeywordCollectionValues();
														});
													</script> 
												</div>
							

													<cfset searchCollClasses = "col-sm-7 col-md-7 col-xl-9">
												
												
											</div>
										</div>
										<div class="row mx-0 my-3">
											<div class="col-12">
												<label for="keySearch" class="sr-only">Keyword search button - click to search MCZbase</label>
												<button type="submit" class="btn btn-xs btn-primary col-12 col-md-auto px-md-5 mx-0 mr-md-5 my-1" id="keySearch" aria-label="Keyword Search of MCZbase"> Search <i class="fa fa-search"></i> </button>
												<button type="reset" class="btn btn-xs btn-warning col-12 col-md-auto px-md-3 mr-md-2 mx-0 my-2 my-sm-1" aria-label="Reset this search form to inital values">Reset</button>
												<button type="button" class="btn btn-xs btn-warning col-12 col-md-auto px-md-3 mr-md-2 mx-0 my-1" aria-label="Start a new specimen search with a clear page" onclick="window.location.href='#Application.serverRootUrl#/Specimens.cfm?action=keywordSearch';">New Search</button>
											</div>
										</div>
									</form>
								</div>
								<!--- results for keyword search --->
								<div class="container-fluid" id="keywordSearchResultsSection">
									<div class="row">
										<div class="col-12">
											<div class="mb-3">
												<div class="row mx-0 mt-0 mt-sm-1 mb-0 pb-2 pb-md-0 jqx-widget-header border px-2">
													<h1 class="h4 pt3px ml-2 ml-md-1">
														<span tabindex="0">Results:</span> 
														<span class="pr-2 font-weight-normal" id="keywordresultCount" tabindex="0"></span> 
														<span id="keywordresultLink" class="font-weight-normal pr-2"></span>
													</h1>
													<div id="keywordshowhide"></div>
													<div id="keywordsaveDialogButton"></div>
													<div id="keywordsaveDialog"></div>
													<div id="keywordcolumnPickDialog">
														<div class="container-fluid">
															<div class="row pick-column-width" id="keywordcolumnPick_row">
																<div class="col-12 col-md-3">
																	<div id="keywordcolumnPick" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="keywordcolumnPick1" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="keywordcolumnPick2" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="keywordcolumnPick3" class="px-1"></div>
																</div>
															</div>
														</div>
													</div>
													<div id="keywordcolumnPickDialogButton"></div>
													<div id="keywordresultDownloadButtonContainer"></div>
													<span id="keywordmanageButton" class=""></span>
													<span id="keywordremoveButtonDiv" class=""></span>
													<div id="keywordresultBMMapLinkContainer"></div>
													<div id="keywordselectModeContainer" class="ml-3" style="display: none;" >
														<script>
															function keywordchangeSelectMode(){
																var selmode = $("##keywordselectMode").val();
																$("##keywordsearchResultsGrid").jqxGrid({selectionmode: selmode});
																if (selmode=="none") { 
																	$("##keywordsearchResultsGrid").jqxGrid({enableBrowserSelection: true});
																} else {
																	$("##keywordsearchResultsGrid").jqxGrid({enableBrowserSelection: false});
																}
															};
														</script>
														<label class="data-entry-label d-inline w-auto mt-1" for="keywordselectMode">Grid Select:</label>
														<select class="data-entry-select d-inline w-auto mt-1" id="keywordselectMode" onChange="keywordchangeSelectMode();">
															<cfif defaultSelectionMode EQ 'singlecell'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="singlecell">Single Cell</option>
															<cfif defaultSelectionMode EQ 'singlerow'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="singlerow">Single Row</option>
															<cfif defaultSelectionMode EQ 'multiplerowsextended'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplerowsextended">Multiple Rows (click, drag, release)</option>
															<cfif defaultSelectionMode EQ 'multiplecellsadvanced'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplecellsadvanced">Multiple Cells (click, drag, release)</option>
														</select>
													</div>

													<output id="keywordactionFeedback" class="btn btn-xs btn-transparent px-2 my-2 mx-1 border-0"></output>
												</div>
												<div class="row mx-0 mt-0""> 
													<!--- Grid Related code is below along with search handlers --->
													<div id="keywordsearchResultsGrid" class="jqxGrid" role="table" aria-label="Search Results Table"></div>
													<div id="keywordPostGridControls" class="p-1 d-none d-md-block" style="display: none;" >
														<!--- a mouse wheel toggle could go here --->
													</div>
													<div id="keywordenableselection"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section> <!--- end keyword search/results panel --->
								<!---Query Builder tab panel--->
<!--- 
Query:
country = France
and (family = 'Mustelidae' or family = 'Lophiidae')
and collector = 'Brendan Haley'

Target JSON:
 [{"nest":"1","field": "COUNTRY","comparator": "=","value": "FRANCE"},{"nest":"2.1","join":"and","field": "FAMILY","comparator": "=","value": "MUSTELIDAE"},{"nest":"2.2","join":"or","field": "FAMILY","comparator": "=","value": "LOPHIIDAE"},{"nest":"3","join":"and","field": "COLLECTORS_AGENT_ID","comparator": "=","value": "15172"}]
--->
							<section id="builderSearchPanel" role="tabpanel" aria-labelledby="builderSearchTabButton" tabindex="-1" class="mx-0 #builderTabActive# unfocus"  #builderTabShow#>
								<div role="search" id="builderSearchFormDiv" class="container-fluid px-0">
									<div class="col-9 float-right px-3"> 
									<button class="btn btn-xs btn-dark help-btn border-0" type="button" data-toggle="collapse" data-target="##collapseBuilder" aria-expanded="false" aria-controls="collapseBuilder">
										Search Help
									</button>
									<aside class="collapse collapseStyle" id="collapseBuilder">
										<div class="card card-body pl-4 py-3 pr-3">
											<h2 class="headerSm">Search Builder Search Help</h2>
											<p>Construct searches on arbitrary sets of fields.  Click the <i>Add</i> button to add a clause to the search, select a field to search, and specify a value to search for.</p>.
											<p>Search terms can be connected with <i>and</i> or <i>or</i>.  Searches using <i>and</i> find records where the criteria on both side of the <i>and</i> are met in each record.  Searches using <i>or</i> find records where at least one of the criteria on each side of the <i>or</i> are met.  Searching for Genus=Babelomurex <i>or</i> Genus=Chicoreus will find specimens with an identification in either of these genera. </p> 
											<p>Use parenthesies to group <i>or</i> terms, e.g. (genus=Urocyon or genus=Vulpes) and (state=Massachusetts or state=Vermont). See an example: <a href='/Specimens.cfm?execute=true&builderMaxRows=6&action=builderSearch&openParens1=1&field1=GEOG_AUTH_REC%3ASTATE_PROV&searchText1=%3DMassachusetts&closeParens1=0&JoinOperator2=or&openParens2=0&field2=GEOG_AUTH_REC%3ASTATE_PROV&searchText2=%3DVermont&closeParens2=0&JoinOperator3=or&openParens3=0&field3=GEOG_AUTH_REC%3ASTATE_PROV&searchText3=%3DNew%20Hampshire&closeParens3=1&JoinOperator4=and&openParens4=1&field4=TAXONOMY%3AGENUS&searchText4=%3DUrocyon&closeParens4=0&JoinOperator6=or&openParens6=0&field6=TAXONOMY%3AGENUS&searchText6=%3DVulpes&closeParens6=1' target="_blank">Red or Gray foxes from MA, NH, or VT</a></p>
											<p>The number of parenthesies you open must equal the number of parenthesies you close in order to run a search.  If there is a mismatch in the count, then the search button will be disabled, and an error message will be show.  For example, <i>open 2 ( but close 1 )</i> means that you need to add another close parenthesis.  Similarly, if your parenthesies incorrectly ordered so as to produce a syntax error an error message will be shown and the search button will be disabled.  Problems with nesting of <i>and</i> and <i>or</i> clauses will produce unexpected results if the logic you specified does not match your expectations.</p>
											<p>Many database fields in multiple tables in MCZbase are available to build a search.
											Each available field is described here: <a href="/specimens/viewSpecimenSearchMetadata.cfm?action=search&execute=true&method=getcf_spec_search_cols&access_role=!HIDE">Search Builder Help Page</a>
											</p>
										</div>
									</aside>
								</div>
									<form id="builderSearchForm" class="container-fluid">
										<script>
											// bind autocomplete to text input/hidden input, and other actions on field selection
											function handleFieldSelection(fieldSelect,rowNumber) { 
												var selection = $('##'+fieldSelect).val();
												console.log(selection);
												console.log(rowNumber);
												for (var i=0; i<columnMetadata.length; i++) {
													if(selection==columnMetadata[i].column) {
														// remove any existing binding.
														$('##searchId'+rowNumber).val("");
														try { 
															$('##searchText'+rowNumber).autocomplete("destroy");
														} catch {}
														$('##searchText'+rowNumber).val("");
														console.log(columnMetadata[i].ui_function);
														var functionToBind = columnMetadata[i].ui_function;
														if (functionToBind.search(/^[A-Za-z]+$/)>-1) {
															//  makeAutocomplete ->  makeAutocomplete(searchText{n},searchId{n})
															var invokeBinding = Function(functionToBind+"('searchText"+ rowNumber+"','searchId"+ rowNumber+"')");
															invokeBinding(); 
														} else if (functionToBind.search(/^[A-Za-z]+\(\)$/)>-1) {
															// makeAutocomplete(text) -> makeAutocomplete(searchText{n})
															var functionName = functionToBind.substring(0,functionToBind.length-2); // remove trailing ()
															var invokeBinding = Function(functionName+"('searchText"+ rowNumber+"')");
															invokeBinding(); 
														} else if (functionToBind.search(/^[A-Za-z]+\(.*:.*\)$/)>-1) {
															// makeAutocomplete(searchId:,searchText:,param) -> makeAutocomplete(searchId{n},searchText{n}:,param)
															var paramsBit = functionToBind.match(/\(.*\)/);
															var functionBit = functionToBind.substring(0,functionToBind.indexOf("("));
															var params = paramsBit[0].substring(1,paramsBit[0].length-1);
															var paramsArray = params.split(',');
															var paramsReady = "";
															var comma = "";
															for (var par in paramsArray) { 
																paramsReady = paramsReady + comma + "'"+paramsArray[par].replace(":",rowNumber)+"'";
																var comma = ",";
															}
															functionToBind = functionBit + "(" + paramsReady + ")";
															console.log(functionToBind);
															var invokeBinding = Function(functionToBind);
															invokeBinding(); 
														}
													}
												}
											}
											// bind autocomplete to text input/hidden input, but don't clear existing values, used on intial page load.
											function handleFieldSetup(fieldSelect,rowNumber) { 
												var selection = $('##'+fieldSelect).val();
												console.log(selection);
												console.log(rowNumber);
												for (var i=0; i<columnMetadata.length; i++) {
													if(selection==columnMetadata[i].column) {
														console.log(columnMetadata[i].ui_function);
														if (columnMetadata[i].ui_function) {
															var functionToBind = columnMetadata[i].ui_function;
															if (functionToBind.search(/^[A-Za-z]+$/)>-1) {
																//  makeAutocomplete(text,id)
																var invokeBinding = Function(functionToBind+"('searchText"+ rowNumber+"','searchId"+ rowNumber+"')");
																invokeBinding(); 
															} else if (functionToBind.search(/^[A-Za-z]+\(\)$/)>-1) {
																// makeAutocomplete(text)
																var functionName = functionToBind.substring(0,functionToBind.length-2); // remove trailing ()
																var invokeBinding = Function(functionName+"('searchText"+ rowNumber+"')");
																invokeBinding(); 
															} else if (functionToBind.search(/^[A-Za-z]+\(.*:.*\)$/)>-1) {
																// makeAutocomplete(searchId:,searchText:,param) -> makeAutocomplete(searchId{n},searchText{n}:,param)
																var paramsBit = functionToBind.match(/\(.*\)/);
																var functionBit = functionToBind.substring(0,functionToBind.indexOf("("));
																var params = paramsBit[0].substring(1,paramsBit[0].length-1);
																var paramsArray = params.split(',');
																var paramsReady = "";
																var comma = "";
																for (var par in paramsArray) { 
																	paramsReady = paramsReady + comma + "'"+paramsArray[par].replace(":",rowNumber)+"'";
																	var comma = ",";
																}
																functionToBind = functionBit + "(" + paramsReady + ")";
																console.log(functionToBind);
																var invokeBinding = Function(functionToBind);
																invokeBinding(); 
															}
														}
													}
												}
											}
										</script>
										<cfif not isDefined("builderMaxRows") or len(builderMaxRows) eq 0>
											<cfset builderMaxRows = 1>
										</cfif>
										<input type="hidden" id="builderMaxRows" name="builderMaxRows" value="#builderMaxRows#">
										<input id="result_id_builderSearch" type="hidden" name="result_id" value="" class="excludeFromLink">
										<input type="hidden" name="method" value="executeBuilderSearch" class="keeponclear excludeFromLink">
										<input type="hidden" name="action" value="builderSearch" class="keeponclear">
										<div class="form-row mx-0">
											<div class="mt-1 col-12 p-0 my-2" id="customFields">
												<div class="form-row mb-2">
													<div class="col-12 col-md-1 pt-3">
														<a aria-label="Add more search criteria" id="addRowButton" class="btn btn-xs btn-primary rounded px-2 mr-md-auto" target="_self" href="javascript:void(0);">Add</a>
													</div>
													<div class="col-12 col-md-1">
														<output id="nestingFeedback"></output>
													</div>
													<div class="col-12 col-md-1">
														<label for="openParens1" class="data-entry-label">&nbsp;</label>
														<cfif not isDefined("openParens1") OR len(trim(openParens1)) EQ 0><cfset openParens1="0"></cfif>
														<select id="openParens1" name="openParens1" class="data-entry-select">
															<cfif openParens1 EQ "0"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="0" #selected#></option>
															<cfif openParens1 EQ "1"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="1" #selected#>(</option>
															<cfif openParens1 EQ "2"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="2" #selected#>((</option>
															<cfif openParens1 EQ "3"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="3" #selected#>(((</option>
															<cfif openParens1 EQ "4"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="4" #selected#>((((</option>
															<cfif openParens1 EQ "5"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="5" #selected#>(((((</option>
														</select>
													</div>
													<div class="col-12 col-md-4">
														<cfquery name="fields" datasource="user_login" username="#session.dbuser#" password="#decrypt(session.epw,cookie.cfid)#" result="fields_result">
															SELECT search_category, cf_spec_search_cols.table_name, cf_spec_search_cols.column_name, column_alias, data_type, 
																label, access_role, ui_function, all_col_comments.comments
															FROM cf_spec_search_cols
																left join all_col_comments 
																	on cf_spec_search_cols.table_name = all_col_comments.table_name 
																		and cf_spec_search_cols.column_name = all_col_comments.column_name
																		and all_col_comments.owner = 'MCZBASE'
															WHERE	
																<cfif oneOfUs EQ 0>
																	access_role = 'PUBLIC'
																<cfelse>
																	access_role IN (<cfqueryparam cfsqltype="CF_SQL_VARCHAR" value="PUBLIC,#session.roles#" list="yes">)
																</cfif>
																AND access_role <> 'HIDE'
															ORDER BY
																search_category, label, cf_spec_search_cols.table_name
														</cfquery>
														<cfset columnMetadata = "[">
														<cfset comma = "">
														<cfloop query="fields">
															<cfset columnMetadata = '#columnMetadata##comma#{"column":"#fields.table_name#:#fields.column_alias#","data_type":"#fields.data_type#","ui_function":"#fields.ui_function#"}'>
															<cfset comma = ",">
														</cfloop>
														<cfset columnMetadata = "#columnMetadata#]">
														<script>
															var columnMetadata = JSON.parse('#columnMetadata#');
														</script>
														<label for="field1" class="data-entry-label">Search Field</label>
														<cfif not isDefined("field1")><cfset field1=""></cfif>
														<select title="Select Field to search..." name="field1" id="field1" class="data-entry-select" required>
															<cfif len(field1) EQ 0>
																<optgroup label="Select a field to search...."><option value="" selected></option></optgroup>
															</cfif>
															<cfset category = "">
															<cfset optgroupOpen = false>
															<cfloop query="fields">
																<cfif category NEQ fields.search_category>
																	<cfif optgroupOpen>
																		</optgroup>
																		<cfset optgroupOpen = false>
																	</cfif>
																	<optgroup label="#fields.search_category#">
																	<cfset optgroupOpen = true>
																	<cfset category = fields.search_category>
																</cfif>
																<cfif field1 EQ "#fields.table_name#:#fields.column_alias#"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																<option value="#fields.table_name#:#fields.column_alias#" #selected#>#fields.label# (#fields.search_category#:#fields.table_name#) #fields.comments#</option>
															</cfloop>
															<cfif optgroupOpen>
																</optgroup>
															</cfif>
														</select>
														<script>
															$(document).ready(function() { 
																$('##field1').jqxComboBox({
																	autoComplete: true,
																	searchMode: 'containsignorecase',
																	width: '100%',
																	dropDownHeight: 400
																});
																// bind an autocomplete, if one applies
																handleFieldSetup('field1',1);
																console.log("field1 setup");
																$('##field1').on("select", function(event) { 
																	handleFieldSelection('field1',1);
																});
																var selectedIndex = $('##field1').jqxComboBox('getSelectedIndex');
																if (selectedIndex<1) {
																	// hack, if intial field1 selection is 0 (-1 is no selection), first on select event doesn't fire.  
																	// forcing clearSelection so that first action on field1 will triggers select event.
																	$('##field1').jqxComboBox('clearSelection');
																}
															});
														</script>
													</div>
													<div class="col-12 col-md-3">
														<cfif not isDefined("searchText1")><cfset searchText1=""></cfif>
														<cfif not isDefined("searchId1")><cfset searchId1=""></cfif>
														<label for="searchText1" class="data-entry-label">Search For</label>
														<input type="text" class="form-control-sm d-flex data-entry-input mx-0" name="searchText1" id="searchText1" value="#encodeForHtml(searchText1)#" required>
														<input type="hidden" name="searchId1" id="searchId1" value="#encodeForHtml(searchId1)#">
														<input type="hidden" name="joinOperator1" id="joinOperator1" value="">
													</div>
													<div class="col-12 col-md-1">
														<label class="data-entry-label" for="closeParens1">&nbsp;</label>
														<cfif not isDefined("closeParens1") OR len(trim(closeParens1)) EQ 0><cfset closeParens1="0"></cfif>
														<select name="closeParens1" id="closeParens1" class="data-entry-select">
															<cfif closeParens1 EQ "0"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="0" #selected#></option>
															<cfif closeParens1 EQ "1"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="1" #selected#>)</option>
															<cfif closeParens1 EQ "2"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="2" #selected#>))</option>
															<cfif closeParens1 EQ "3"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="3" #selected#>)))</option>
															<cfif closeParens1 EQ "4"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="4" ##>))))</option>
															<cfif closeParens1 EQ "5"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option value="5" ##>)))))</option>
														</select>
													</div>
													<script> 
														$(document).ready(function(){
															$('##openParens1').on("change", function(event) { isNestingOk(); }); 
															$('##closeParens1').on("change", function(event) { isNestingOk(); });
														});
													</script> 
													<div class="col-12 col-md-1">
														<cfif isdefined("session.roles") and listfindnocase(session.roles,"global_admin")>
															<label class="data-entry-label" for="debug3">Debug</label>
															<select title="debug" name="debug" id="debug3" class="data-entry-select">
																<option value=""></option>
																<cfif isdefined("debug") AND len(debug) GT 0><cfset selected=" selected "><cfelse><cfset selected=""></cfif>
																<option value="true" #selected#>Debug JSON</option>
															</select>
														</cfif>
													</div>
												</div>
												<cfif builderMaxRows GT 1>
													<cfset parenOpen = 0>
													<cfloop index="row" from="2" to="#builderMaxRows#">
														<cfif isDefined("field#row#")>
															<div class="form-row mb-2" id="builderRow#row#">
																<div class="col-12 col-md-1">
																	&nbsp;
																</div>
																<div class="col-12 col-md-1">
																	<select title="Join Operator" name="JoinOperator#row#" id="joinOperator#row#" class="data-entry-select bg-white mx-0 d-flex">
																		<cfif isDefined("joinOperator#row#") AND Evaluate("joinOperator#row#") EQ "or">
																			<cfset orSel = "selected">
																			<cfset andSel = "">
																		<cfelse>
																			<cfset orSel = "">
																			<cfset andSel = "selected">
																		</cfif>
																		<option value="and" #andSel# >and</option>
																		<option value="or" #orSel# >or</option>
																	</select>
																</div>
																<div class="col-12 col-md-1">
																	<cfif isDefined("openParens#row#")>
																		<cfset openParens = Evaluate("openParens#row#")>
																	<cfelse>
																		<cfset openParens = 0>
																	</cfif>
																	<select id="openParens#row#" name="openParens#row#" class="data-entry-select">
																		<cfif openParens EQ "0"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="0" #selected#></option>
																		<cfif openParens EQ "1"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="1" #selected#>(</option>
																		<cfif openParens EQ "2"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="2" #selected#>((</option>
																		<cfif openParens EQ "3"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="3" #selected#>(((</option>
																		<cfif openParens EQ "4"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="4" #selected#>((((</option>
																		<cfif openParens EQ "5"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value=5" #selected#>(((((</option>
																	</select>
																</div>
																<!--- " --->
																<div class="col-12 col-md-4">
																	<select title="Select Field..." name="field#row#" id="field#row#" class="data-entry-select">
																		<cfset category = "">
																		<cfset optgroupOpen = false>
																		<cfloop query="fields">
																			<cfif category NEQ fields.search_category>
																				<cfif optgroupOpen>
																					</optgroup>
																					<cfset optgroupOpen = false>
																				</cfif>
																				<optgroup label="#fields.search_category#">
																				<cfset optgroupOpen = true>
																				<cfset category = fields.search_category>
																			</cfif>
																			<cfif Evaluate("field#row#") EQ "#fields.table_name#:#fields.column_alias#"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																			<option value="#fields.table_name#:#fields.column_alias#" #selected#>#fields.label# (#fields.search_category#:#fields.table_name#)</option>
																		</cfloop>
																		<cfif optgroupOpen>
																			</optgroup>
																		</cfif>
																	</select>
																	<script>
																		$(document).ready(function() { 
																			$('##field#row#').jqxComboBox({
																				autoComplete: true,
																				searchMode: 'containsignorecase',
																				width: '100%',
																				dropDownHeight: 400
																			});
																			// bind an autocomplete, if one applies.
																			handleFieldSetup('field#row#',#row#);
																			console.log("Setup #row#");
																			$('##field#row#').on("select", function(event) { 
																				console.log("Select on #row#");
																				handleFieldSelection('field#row#',#row#);
																			});
																		});
																	</script>
																</div>
																<div class="col-12 col-md-3">
																	<cfif isDefined("searchText#row#")><cfset sval = Evaluate("searchText#row#")><cfelse><cfset sval=""></cfif>
																	<cfif isDefined("searchId#row#")><cfset sival = Evaluate("searchId#row#")><cfelse><cfset sival=""></cfif>
																	<input type="text" class="data-entry-input" name="searchText#row#" id="searchText#row#" placeholder="Enter Value" value="#encodeForHtml(sval)#">
																	<input type="hidden" name="searchId#row#" id="searchId#row#" value="#encodeForHtml(sival)#" >
																</div>
																<div class="col-12 col-md-1">
																	<cfif isDefined("closeParens#row#")>
																		<cfset closeParens = Evaluate("closeParens#row#")>
																	<cfelse>
																		<cfset closeParens = 0>
																	</cfif>
																	<select id="closeParens#row#" name="closeParens#row#" class="data-entry-select">
																		<cfif closeParens EQ "0"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="0" #selected#></option>
																		<cfif closeParens EQ "1"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="1" #selected#>)</option>
																		<cfif closeParens EQ "2"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="2" #selected#>))</option>
																		<cfif closeParens EQ "3"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="3" #selected#>)))</option>
																		<cfif closeParens EQ "4"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="4" #selected#>))))</option>
																		<cfif closeParens EQ "5"><cfset selected="selected"><cfelse><cfset selected=""></cfif>
																		<option value="5" #selected#>)))))</option>
																	</select>
																	<script> 
																		$(document).ready(function(){
																			$('##openParens#row#').on("change", function(event) { isNestingOk(); } );
																			$('##closeParens#row#').on("change", function(event) { isNestingOk(); } );
																		});
																	</script> 
																</div>
																<div class="col-12 col-md-1">
																	<button type='button' onclick=' removeBuilderRow(#row#);' arial-label='remove this row from the builder' class='btn btn-xs px-3 btn-warning mr-auto'>Remove</button>
																</div>
															</div>
														</cfif>
													</cfloop>
												</cfif>
							
											</div><!--- end customFields: new form rows get appended here --->
											<script>
												function removeBuilderRow(row) {
													$("##builderRow"+row).remove();
													isNestingOk(); 
												} 
												function isNestingOk() { 
													$('##nestingFeedback').html("");		
													$('##nestingFeedback').removeClass('text-danger');
													var result = false;
													var countOpen = 0;
													var countClose = 0;
													var rows = $("##builderMaxRows").val();
													rows = parseInt(rows);
													for (row=1; row<=rows; row++) { 
														if (row && $('##openParens'+row).length) { 
															countOpen = countOpen + parseInt($('##openParens'+row).val());
															countClose = countClose + parseInt($('##closeParens'+row).val());
														}
													}
													if (countOpen==countClose) { 
														console.log("Parenthesies counts match.");
														const parens = new Array();
														var nestOrderOk = true;
														var errorText = "";
														for (row=1; row<=rows; row++) { 
															var open = parseInt($('##openParens'+row).val());
															var close = parseInt($('##closeParens'+row).val());
															if (open>0) { 
																for (i=1; i<= open; i++) { 
																	parens.push("(");
																}
															}
															if (close>0) {
																for (i=1; i<= close; i++) { 
																	if (parens.length > 0) { 
																		parens.pop();
																	} else { 
																		console.log("Error in nesting of parenthesies, all opens consumed.");
																		errorText = "( without )";
																		nestOrderOk = false;
																	}
																}  
															}  
														} 
														if (parens.length > 0) { 
															console.log("Error in nesting of parenthesies, remaining open.");
															errorText = ") without (";
															nestOrderOk = false;
														}
														if (nestOrderOk) { 
															console.log("Parenthesies nest.");
															result = true;
															$('##searchbuilder-search').prop("disabled",false);
														}  else { 
															$('##nestingFeedback').html("nesting error<br>"+errorText);		
															$('##nestingFeedback').addClass('text-danger');
															$('##searchbuilder-search').prop("disabled",true);
															result=false;
														} 
													} else { 
														console.log("Parenthesies mismatched: " + countOpen + " opened, but " + countClose + " closed.");
														$('##nestingFeedback').html("open " + countOpen + " ( but <br>close " + countClose + " )");		
														$('##nestingFeedback').addClass('text-danger');
														$('##searchbuilder-search').prop("disabled",true);
													} 
													return result;
												}
												function addBuilderRow() { 
													var row = $("##builderMaxRows").val();
													row = parseInt(row) + 1;
													var newControls = '<div class="form-row mb-2" id="builderRow'+row+'">';
													newControls = newControls + '<div class="col-12 col-md-1">&nbsp;';
													newControls = newControls + '</div>';
													newControls = newControls + '<div class="col-12 col-md-1">';
													newControls = newControls + '<select title="Join Operator" name="JoinOperator'+row+'" id="joinOperator'+row+'" class="data-entry-select bg-white mx-0 d-flex"><option value="and">and</option><option value="or">or</option></select>';
													newControls = newControls + '</div>';
													newControls = newControls + '<div class="col-12 col-md-1">';
													newControls = newControls + '<select name="openParens'+row+'" id="openParens'+row+'" class="data-entry-select">';
													newControls = newControls + '<option value="0"></option><option value="1">(</option>';
													newControls = newControls + '<option value="2">((</option><option value="3">(((</option>';
													newControls = newControls + '<option value="4">((((</option>';
													newControls = newControls + '<option value="5">(((((</option>';
													newControls = newControls + '</select>';
													newControls = newControls + '</div>';
													newControls= newControls + '<div class="col-12 col-md-4">';
													newControls = newControls + '<select title="Select Field..." name="field'+row+'" id="field'+row+'" class="data-entry-select">';
													newControls = newControls + '<optgroup label="Select a field to search...."><option value="" selected></option></optgroup>';
													<cfset category = "">
													<cfset optgroupOpen = false>
													<cfloop query="fields">
														<cfif category NEQ fields.search_category>
															<cfif optgroupOpen>
																newControls = newControls + '</optgroup>';
																<cfset optgroupOpen = false>
															</cfif>
															newControls = newControls + '<optgroup label="#fields.search_category#">';
															<cfset optgroupOpen = true>
															<cfset category = fields.search_category>
														</cfif>
														newControls = newControls + '<option value="#fields.table_name#:#fields.column_alias#">#fields.label# (#fields.search_category#:#fields.table_name#)</option>';
													</cfloop>
													<cfif optgroupOpen>
														newControls = newControls + '</optgroup>';
													</cfif>
													newControls = newControls + '</select>';
													newControls= newControls + '</div>';
													newControls= newControls + '<div class="col-12 col-md-3">';
													newControls = newControls + '<input type="text" class="data-entry-input" name="searchText'+row+'" id="searchText'+row+'" placeholder="Enter Value"/>';
													newControls = newControls + '<input type="hidden" name="searchId'+row+'" id="searchId'+row+'" >';
													newControls = newControls + '</div>';
													newControls = newControls + '<div class="col-12 col-md-1">';
													newControls = newControls + '<select name="closeParens'+row+'" id="closeParens'+row+'" class="data-entry-select">';
													newControls = newControls + '<option value="0"></option><option value="1">)</option>';
													newControls = newControls + '<option value="2">))</option><option value="3">)))</option>';
													newControls = newControls + '<option value="4">))))</option>';
													newControls = newControls + '<option value="5">)))))</option>';
													newControls = newControls + '</select>';
													newControls= newControls + '</div>';
													newControls= newControls + '<div class="col-12 col-md-1">';
													newControls = newControls + '<button type="button" onclick=" removeBuilderRow(' + row + ');" arial-label="remove this row from the builder" class="btn btn-xs px-3 btn-warning mr-auto">Remove</button>';
													newControls = newControls + '</div>';
													newControls = newControls + '</div>';
													$("##customFields").append(newControls);
													$("##builderMaxRows").val(row);
													$('##field' + row).jqxComboBox({
														autoComplete: true,
														searchMode: 'containsignorecase',
														width: '100%',
														dropDownHeight: 400
													});
													var handleSelectString = "handleFieldSelection('field"+row+"',"+row+")";
													$('##field'+row).on("change", function(event) { 
														var handleSelect = new Function(handleSelectString);
														handleSelect();
													});
													$('##openParens'+row).on("change", function(event) { isNestingOk(); } )
													$('##closeParens'+row).on("change", function(event) { isNestingOk(); } )
												};
												$(document).ready(function(){
													$("##addRowButton").click(function(){
													   addBuilderRow();
													});
												});
											</script>
										</div>
										<div class="form-row mb-3">
											<div class="col-12">
												<button type="submit" class="btn btn-xs btn-primary col-12 col-md-auto px-md-5 mx-0 mr-md-5 my-1" id="searchbuilder-search" aria-label="run the search builder search">Search <i class="fa fa-search"></i></button>
												<button type="reset" class="btn btn-xs btn-outline-warning col-12 col-md-auto px-md-3 mr-md-2 mx-0 my-1" aria-label="Reset this search form to inital values" disabled>Reset</button>
												<button type="button" class="btn btn-xs btn-warning col-12 col-md-auto px-md-3 mr-md-2 mx-0 my-1" aria-label="Start a new specimen search with a clear page" onclick="window.location.href='#Application.serverRootUrl#/Specimens.cfm?action=builderSearch';">New Search</button>
												
											</div>
										</div>
									</form>


								</div>
								<!--- results for search builder search --->
								<div class="container-fluid" id="builderSearchResultsSection" aria-live="polite">
									<div class="row mx-0">
										<div class="col-12">
											<div class="mb-3">
												<div class="row mt-1 mb-0 pb-2 pb-md-0 jqx-widget-header border px-2">
													<h1 class="h4 pt3px ml-2 ml-md-1">
														<span tabindex="0">Results: </span> 
														<span class="pr-2 font-weight-normal" id="builderresultCount" tabindex="0"></span> 
														<span id="builderresultLink" class="pr-2 font-weight-normal"></span>
													</h1>
													<div id="buildershowhide"></div>
													<div id="buildersaveDialogButton"></div>
													<div id="buildersaveDialog"></div>
													<div id="buildercolumnPickDialog">
														<div class="container-fluid">
															<div class="row pick-column-width" id="buildercolumnPick_row">
																<div class="col-12 col-md-3">
																	<div id="buildercolumnPick" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="buildercolumnPick1" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="buildercolumnPick2" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="buildercolumnPick3" class="px-1"></div>
																</div>
															</div>
														</div>
													</div>
													<div id="buildercolumnPickDialogButton"></div>
													<div id="builderresultDownloadButtonContainer"></div>
													<span id="buildermanageButton" class=""></span>
													<span id="builderremoveButtonDiv" class=""></span>
													<div id="builderresultBMMapLinkContainer"></div>
													<div id="builderselectModeContainer" class="ml-3" style="display: none;" >
														<script>
															function builderchangeSelectMode(){
																var selmode = $("##builderselectMode").val();
																$("##buildersearchResultsGrid").jqxGrid({selectionmode: selmode});
																if (selmode=="none") { 
																	$("##buildersearchResultsGrid").jqxGrid({enableBrowserSelection: true});
																} else {
																	$("##buildersearchResultsGrid").jqxGrid({enableBrowserSelection: false});
																}
															};
														</script>
														<label class="data-entry-label d-inline w-auto mt-1" for="builderselectMode">Grid Select:</label>
														<select class="data-entry-select d-inline w-auto mt-1" id="builderselectMode" onChange="builderchangeSelectMode();">
															<cfif defaultSelectionMode EQ 'none'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="none">Text</option>
															<cfif defaultSelectionMode EQ 'singlecell'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="singlecell">Single Cell</option>
															<cfif defaultSelectionMode EQ 'singlerow'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="singlerow">Single Row</option>
															<cfif defaultSelectionMode EQ 'multiplerowsextended'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplerowsextended">Multiple Rows (click, drag, release)</option>
															<cfif defaultSelectionMode EQ 'multiplecellsadvanced'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplecellsadvanced">Multiple Cells (click, drag, release)</option>
														</select>
													</div>
													<output id="builderactionFeedback" class="btn btn-xs btn-transparent my-2 px-2 mx-1 border-0"></output> 
												</div>
												<div class="row mt-0"> 
													<!--- Grid Related code is below along with search handlers --->
													<div id="buildersearchResultsGrid" class="jqxGrid" role="table" aria-label="Search Results Table"></div>
													<div id="builderPostGridControls" class="p-1 d-none d-md-block" style="display: none;" >
														<!--- a mouse wheel toggle could go here --->
													</div>
													<div id="builderenableselection"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</section><!--- end search builder tab --->
						</div>
					</div>
				</div>
			</div>
		</main>
		<!--- 
		<div>
			<div class="col-12 col-md-6 mx-auto mb-3 pb-3">
				<p class="blockquote small text-center">Collection records at the Museum of Comparative Zoology may contain language that reflect historical place or taxon names in its original form that are no longer acceptable or appropriate in an inclusive environment. While the MCZ is  preserving data in their original form in order to retain authenticity and facilitate research, we do not condone this language and are committed to address the problem of racial and other derogatory language present in our database.</p>
			</div>
		</div>
		--->
		<div id="overlay" style="position: absolute; top:0px; left:0px; width: 100%; height: 100%; background: rgba(0,0,0,0.5); border-color: transparent; opacity: 0.99; display: none; z-index: 2;">
			<div class="jqx-rc-all jqx-fill-state-normal" style="position: absolute; left: 50%; top: 25%; width: 10em; height: 2.4em;line-height: 2.4em; padding: 5px; color: ##333333; border-color: ##898989; border-style: solid; margin-left: -5em; opacity: 1;">
				<div class="jqx-grid-load" style="float: left; overflow: hidden; height: 32px; width: 32px;"></div>
				<div style="float: left; display: block; margin-left: 1em;" >Searching...</div>	
			</div>
		</div>	
	</div><!--- end overlaycontainer --->	

	<!---  TODO: Work the special case specimen search showLeftPush and showRightPush sections back into the standard grid divs used everywhere else above.
			<section class="container-fluid">
				<div class="row">
					<div class="col-12">
						<div id="jqxWidget">
							<div class="mb-5">
								<div class="row mx-0">
								<div id="searchResultsGrid" class="jqxGrid"></div>
								<div class="mt-005" id="enableselection"></div>
								<div style="margin-top: 30px;">
									<div id="cellbegineditevent"></div>
									<div style="margin-top: 10px;" id="cellendeditevent"></div>
								</div>
								<div id="popupWindow" style="display:none;">
									<div style="padding:.25em;">Edit</div>
									<div style="overflow: hidden;">
										<div class="container-fluid">
											<div class="row">
												<fieldset>
													<legend class="sr-only">Editable fields</legend>
													<label for="imageurl">Image:</label>
													<input id="imageurl" class="fs-13 mx-1 px-1 border-0">
													<label for="collection">Collection:</label>
													<input id="collection" class="mx-1 px-1 border-0">
													<label for="cat_num">Catalog Number:</label>
													<input id="cat_num" class="mx-1 px-1 border-0">
													<label for="began_date">Began Date:</label>
													<input id="began_date" class="mx-1">
													<label for="ended_date">Ended Date:</label>
													<input id="ended_date" class="mx-1">
													<label for="scientific_name">Scientific Name:</label>
													<input id="scientific_name" class="mx-1 px-1 border-0">
													<label for="higher_geog">Higher Geography:</label>
													<input id="higher_geog" class="mx-1 px-1 border-0">
													<label for="spec_locality">Specific Locality:</label>
													<input id="spec_locality" class="mx-1 px-1 border-0">
													<label for="collectors">Collectors:</label>
													<input id="collectors" class="mx-1 border-0" />
													<label for="verbatim_date">Verbatim Date:</label>
													<input id="verbatim_date" class="mx-1 border-0">
													<label for="coll_obj_disposition">Disposition:</label>
													<input id="coll_obj_disposition" class="mx-1 border-0">
													<label for="othercatalognumbers">Other Cat Nums:</label>
													<textarea id="othercatalognumbers" class="mx-1 border-0"></textarea>
													<input aria-label="save button" class="mr-1" type="button" id="Save" value="Save" />
													<input aria-label="cancel button" id="Cancel" type="button" value="Cancel" />
												</fieldset>
											</div>
										</div>
									</div>
								</div>
							</div>
							</div>
							<nav aria-label="filter_menu" class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right zindex-sticky" id="cbp-spmenu-s2">
							<section> <a id="showRightPush" class="btn black-filter-btn hiddenclass" role="button" aria-label="refine results slider">Refine Results</a> </section>
							<h3 class="filters">Refine Results</h3>
							<div class="col-md-3 py-2 px-4 mb-3 pl-3 bg-transparent">
								<div class="float-left">
									<label for="columnchooser" class="mt-1"><em>By Columns in Dropdown</em></label>
									<div id="columnchooser" class="mb-1"></div>
									<div class="mt-2"><em>Then by checkboxes of values</em></div>
									<div class="mt-1 ml-0 d-inline float-left w-257" id="filterbox">
										<p>Search for something to filter</p>
									</div>
									<div>
										<input type="button" id="applyfilter" class="d-inline float-left ml-0 mr-3 mt-2 py-1 px-2 fs-14" aria-label="apply filter" value="Apply Filter"/>
										<input type="button" id="clearfilter" class="d-inline ml-0 mt-2 py-1 px-2 fs-14" value="Clear Filter"/>
									</div>
								</div>
							</nav>
							<nav aria-label="choose_columns" class="cbp-spmenu cbp-spmenu-vertical-left cbp-spmenu-left zindex-sticky" id="cbp-spmenu-s3">
								<section> <a id="showLeftPush" class="btn black-columns-btn hiddenclass" aria-label="display column selections" role="button">Columns</a> </section>
								<h3 class="columns">Display Columns</h3>
								<div class="col-md-3 mb-3 pl-1 mt-2">
									<ul class="checks">
										<li>
											<input type="radio" aria-label="check all">
											Check all </li>
										<li>
											<input type="radio" aria-label="most often displayed">
											Minimum</li>
									</ul>
									<div class="float-left zindex-sticky bg-white">
										<div id="jqxlistbox2" class="ml-1 mt-3"></div>
									</div>
								</div>
							</nav>
						</div>
					</div>
				</div>
			</section>
		</main>
		--->
	
	<div class="container-fluid" id="fixedSearchResultsSection">
									<div class="row">
										<div class="col-12">
											<div class="mb-3">
												<div class="row mx-0 mt-1 mb-0 pb-2 pb-md-0 jqx-widget-header border px-2">
													<h1 class="h4 ml-2 ml-md-1 pt3px">
														<span tabindex="0">Results:</span> 
														<span class="pr-2 font-weight-normal" id="fixedresultCount" tabindex="0"></span> 
														<span id="fixedresultLink" class="font-weight-normal pr-2"></span>
													</h1>
													<div id="fixedshowhide"></div>
													<div id="fixedsaveDialogButton" class=""></div>
													<div id="fixedsaveDialog"></div>
													<div id="fixedcolumnPickDialog">
														<div class="container-fluid">
															<div class="row pick-column-width" id="fixedcolumnPick_row">
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick1" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick2" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick3" class="px-1"></div>
																</div>
															</div>
														</div>
													</div>
													<div id="fixedcolumnPickDialogButton"></div>
													<div id="fixedresultDownloadButtonContainer"></div>
													<span id="fixedmanageButton" class=""></span>
													<span id="fixedremoveButtonDiv" class=""></span>
													<div id="fixedresultBMMapLinkContainer"></div>
													<div id="fixedselectModeContainer" class="ml-3" style="display: none;" >
														<script>
															function fixedchangeSelectMode(){
																var selmode = $("singlecell").val();
																$("##fixedsearchResultsGrid").jqxGrid({selectionmode: selmode});
																if (selmode=="singlecell") { 
																	$("##fixedsearchResultsGrid").jqxGrid({enableBrowserSelection: true});
																} else {
																	$("##fixedsearchResultsGrid").jqxGrid({enableBrowserSelection: false});
																}
															};
														</script>

														<label class="data-entry-label d-inline w-auto mt-1" for="fixedselectMode">Grid Select:</label>
														<select class="data-entry-select d-inline w-auto mt-1" id="fixedselectMode" onChange="fixedchangeSelectMode();">
															<cfif defaultSelectionMode EQ 'singlecell'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option selected value="singlecell">Single Cell</option>
															<cfif defaultSelectionMode EQ 'singlerow'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="singlerow">Single Row</option>
															<cfif defaultSelectionMode EQ 'multiplerowsextended'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplerowsextended">Multiple Rows (click, drag, release)</option>
															<cfif defaultSelectionMode EQ 'multiplecellsadvanced'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplecellsadvanced">Multiple Cells (click, drag, release)</option>
														</select>
													</div>
												
													<output id="fixedactionFeedback" class="btn btn-xs btn-transparent my-2 px-2 mx-1 pt-1 border-0"></output>
												</div>
												<!--- TODO: Figure out how to make this sticky row work on the column header row --->
												<div class="row mx-0 mt-0"> 
													
													<!--- Grid Related code is below along with search handlers --->
													<div id="fixedsearchResultsGrid" class="jqxGrid" role="table" aria-label="Search Results Table">
													</div>
													<div id="fixedPostGridControls" class="p-1 d-none d-md-block" style="display: none;" >
														<!--- a mouse wheel toggle could go here --->
													</div>
													
												</div>
											</div>
										</div>
									</div>
								</div>
<div id="testGrid"></div>
<script>
//var data = [ { name: "A", age: 1 }, { name: "B", age: 2 } ];
//var source = { datatype: "array", localdata: data };
//var dataAdapter = new $.jqx.dataAdapter(source);

	$("##fixedsearchResultsGrid").jqxGrid({
					width: '100%',
					autoheight: 'true',
					source: dataAdapter,
					filterable: false,
					sortable: true,
					pageable: true,
					editable: false,
					virtualmode: true,
					enablemousewheel: #session.gridenablemousewheel#,
					keyboardnavigation: true,
					pagesize: '#session.specimens_pagesize#',
					pagesizeoptions: ['5','10','25','50','100','500'], // fixed list regardless of actual result set size, dynamic reset goes into infinite loop.
					showaggregates: true,
					columnsresize: true,
					autoshowfiltericon: true,
					autoshowcolumnsmenubutton: false,
					autoshowloadelement: false,  // overlay acts as load element for form+results
					columnsreorder: true,
					groupable: true,
					selectionmode: 'singlecell',
					//enablebrowserselection: #defaultenablebrowserselection#,
					altrows: true,
					showtoolbar: false,
//					ready: function () {
//						$("##fixedsearchResultsGrid").jqxGrid('selectrow', 0);
//						$("##fixedsearchResultsGrid").jqxGrid('focus');
//					},
					rendergridrows: function () {
						return dataAdapter.records;
					},
					columns: [
						<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
							<cfif isdefined("session.killRow") AND session.killRow GT 0>
								<cfset removerow = "{text: 'Remove', datafield: 'RemoveRow', cellsrenderer:removeFixedCellRenderer, width: 40, cellclassname: fixedcellclass, hidable:false, hidden: false },">
								#removerow#
							</cfif>
						</cfif>
						<cfset lastrow ="">
						<cfloop query="getFieldMetadata">
							<cfset cellrenderer = "">
							<cfif len(getFieldMetadata.cellsrenderer) GT 0>
								<cfif left(getFieldMetadata.cellsrenderer,1) EQ "_"> 
									<cfset cellrenderer = " cellsrenderer:fixed#getFieldMetadata.cellsrenderer#,">
								<cfelse>
									<cfset cellrenderer = " cellsrenderer:#getFieldMetadata.cellsrenderer#,">
								</cfif>
							</cfif> 
							<cfif ucase(data_type) EQ 'DATE'>
								<cfset filtertype = " filtertype: 'date',">
							<cfelse>
								<cfset filtertype = "">
							</cfif>
							<cfif ucase(column_name) EQ lastcolumn>
								<!--- last column, no trailing comma --->
								<cfset lastrow = "{text: '#label#', datafield: '#ucase(column_name)#',#filtertype##cellrenderer# width: #width#, cellclassname: fixedcellclass, hidable:#hideable#, hidden: getColHidProp('#ucase(column_name)#', #hidden#), editable: false }">
							<cfelse> 
								{text: '#label#', datafield: '#ucase(column_name)#',#filtertype##cellrenderer# width: #width#, cellclassname: fixedcellclass, hidable:#hideable#, hidden: getColHidProp('#ucase(column_name)#', #hidden#) },
							</cfif>
						</cfloop>
						#lastrow#
					],
					
					rowdetails: true,
					rowdetailstemplate: {
						rowdetails: "<div style='margin: 10px;'>Row Details</div>",
						rowdetailsheight:  1 // row details will be placed in popup dialog
					},
					initrowdetails: initRowDetails
				});

				<cfif isdefined("session.username") and len(#session.username#) gt 0>
					$('##fixedsearchResultsGrid').jqxGrid().on("columnreordered", function (event) { 
						columnOrderChanged('fixedsearchResultsGrid'); 
					}); 
				</cfif>
				
				$("##fixedsearchResultsGrid").on("bindingcomplete", function(event) {
					
					
						$("##fixedsearchResultsGrid").attr('tabindex', 0);

						// Set all interactive descendants to non-tabbable
						$("##fixedsearchResultsGrid").find('a, button, input').attr('tabindex', -1);

						var columns = $("##fixedsearchResultsGrid").jqxGrid('columns').records;
						if (columns && columns.length > 0) {
							$("##fixedsearchResultsGrid").jqxGrid('selectcell', 0, columns[0].datafield);
						}
						$("##fixedsearchResultsGrid").focus();

						// The rest of your existing logic...
						$("##fixedsearchResultsGrid").on('focusin', function(event) {
							// Check if any cell is already selected
							var selection = $("##fixedsearchResultsGrid").jqxGrid('getselectedcell');
							if (!selection || typeof selection.rowindex === "undefined" || !selection.datafield) {
								var columns = $("##fixedsearchResultsGrid").jqxGrid('columns').records;
								if (columns && columns.length > 0) {
									$("##fixedsearchResultsGrid").jqxGrid('selectcell', 0, columns[0].datafield);
								}
							}
						});
					
					<cfif NOT isDefined("session.gridscrolltotop") OR session.gridscrolltotop EQ "true">
						if (document <= 900){
							$(document).scrollTop(200);
						} else {
							$(document).scrollTop(480);
						}
					</cfif>
			
					// add a link out to this search, serializing the form as http get parameters
					$('##fixedresultLink').html('<a href="/Specimens.cfm?execute=true&' + $('##fixedSearchForm :input').filter(function(index,element){ return $(element).val()!='';}).not(".excludeFromLink").serialize() + '">Link to this search</a>');
					$('##fixedshowhide').html('<button class="my-2 border rounded" title="hide search form" onclick=" toggleSearchForm(\'fixed\'); "><i id="fixedSearchFormToggleIcon" class="fas fa-eye-slash"></i></button>');
					if (fixedSearchLoaded==0) { 
						try { 
							gridLoaded('fixedsearchResultsGrid','occurrence record','fixed');
						} catch (e) { 
							console.log(e);
							messageDialog("Error in gridLoaded handler:" + e.message,"Error in gridLoaded");
						}
						fixedSearchLoaded = 1;
						loadColumnOrder('fixedsearchResultsGrid');
					}
					<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
						$('##fixedmanageButton').html('<a href="specimens/manageSpecimens.cfm?result_id='+$('##result_id_fixedSearch').val()+'" target="_blank" class="btn btn-xs btn-secondary px-2 my-2 mx-1" >Manage</a>');
					<cfelse>
						$('##fixedmanageButton').html('');
					</cfif>
					<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
						<cfif isdefined("session.killRow") AND session.killRow EQ 2>
							<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
								$('##fixedremoveButtonDiv').html('<button id="fixedremoveButton" class="btn btn-xs btn-secondary px-2 my-2 mx-1 disabled" disabled onclick="removeFixedSelectedRows(); " >Remove Checked</a>');
							<cfelse>
								$('##fixedremoveButtonDiv').html('');
							</cfif>
						</cfif>
					</cfif>
					pageLoaded('fixedsearchResultsGrid','occurrence record','fixed');
					<cfif isDefined("session.specimens_pin_guid") AND session.specimens_pin_guid EQ 1> 
						console.log(#session.specimens_pin_guid#);
						setPinColumnState('fixedsearchResultsGrid','GUID',true);
					</cfif>
				});
				$('##fixedsearchResultsGrid').on('rowexpand', function (event) {
					//  Create a content div, add it to the detail row, and make it into a dialog.
					var args = event.args;
					var rowIndex = args.rowindex;
					var datarecord = args.owner.source.records[rowIndex];
					console.log(rowIndex);
					createSpecimenRowDetailsDialog('fixedsearchResultsGrid','fixedrowDetailsTarget',datarecord,rowIndex);
				});
				$('##fixedsearchResultsGrid').on('rowcollapse', function (event) {
					// remove the dialog holding the row details
					var args = event.args;
					var rowIndex = args.rowindex;
					$("##fixedsearchResultsGridRowDetailsDialog" + rowIndex ).dialog("destroy");
				});
				// display selected row index.
				$("##fixedsearchResultsGrid").on('rowselect', function (event) {
					$("##fixedselectrowindex").text(event.args.rowindex);
				});
				// display unselected row index.
				$("##fixedsearchResultsGrid").on('rowunselect', function (event) {
					$("##fixedunselectrowindex").text(event.args.rowindex);
				});
			});
</script>

							

<cfinclude template="/shared/_footer.cfm">
