<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://jqwidgets.com/public/jqwidgets/styles/jqx.base.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcore.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdata.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxbuttons.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxscrollbar.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxmenu.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdata.export.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.js"></script>  
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.filter.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.edit.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.sort.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.selection.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.export.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.storage.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcombobox.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.pager.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.grouping.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.aggregates.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.columnsresize.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxgrid.columnsreorder.js"></script> 

	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxwindow.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/globalization/globalize.js"></script> 
	
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxlistbox.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdropdownlist.js"></script>
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdraw.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxchart.core.js"></script>

	 
	 
	
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdatetimeinput.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdate.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxslider.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxpanel.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxinput.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxdragdrop.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcalendar.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxtree.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxinput.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxexport.js"></script> 
	 


<script type="text/javascript" src="/shared/js/shared-scripts.js"></script>

	<script type="text/javascript" src="/shared/js/internal-scripts.js"></script> 
	<script type="text/javascript" src="/shared/js/vocabulary_scripts.js"></script>
	<script type="text/javascript" src="/users/js/internal.js"></script>

	
	<script type="text/javascript" src="/annotations/js/annotations.js"></script>


 

<script type="text/javascript" src="/lib/misc/jquery-ui-multiselect-widget-3.0.0/src/jquery.multiselect.js"></script> 
<script type="text/javascript" src="/lib/misc/jquery-ui-multiselect-widget-3.0.0/src/jquery.multiselect.filter.js"></script>


<script type="text/javascript" src="/lib/misc/multizoom/multizoom.js"></script><style type="text/css">.featuredimagezoomerhidden {visibility: hidden!important;}</style>
<link rel="stylesheet" href="/lib/misc/multizoom/multizoom.css">


	<script type="text/javascript" src="/specimens/js/search.js"></script> 
	<script type="text/javascript" src="/lib/JQWidgets/jqwidgets_ver20.0.0/jqwidgets/jqxcheckbox.js"></script>
	<script type="text/javascript" src="/specimens/js/specimens.js"></script>

	<script type="text/javascript" src="/shared/js/tabs.js"></script>

	<script type="text/javascript" src="/transactions/js/transactions.js"></script>

	<script type="text/javascript" src="/taxonomy/js/taxonomy.js"></script>
</head>
<body>
	
	<div class="container-fluid" id="fixedSearchResultsSection">
									<div class="row">
										<div class="col-12">
											<div class="mb-3">
												<div class="row mx-0 mt-1 mb-0 pb-2 pb-md-0 jqx-widget-header border px-2">
													<h1 class="h4 ml-2 ml-md-1 pt3px">
														<span tabindex="0">Results:</span> 
														<span class="pr-2 font-weight-normal" id="fixedresultCount" tabindex="0"></span> 
														<span id="fixedresultLink" class="font-weight-normal pr-2"></span>
													</h1>
													<div id="fixedshowhide"></div>
													<div id="fixedsaveDialogButton" class=""></div>
													<div id="fixedsaveDialog"></div>
													<div id="fixedcolumnPickDialog">
														<div class="container-fluid">
															<div class="row pick-column-width" id="fixedcolumnPick_row">
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick1" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick2" class="px-1"></div>
																</div>
																<div class="col-12 col-md-3">
																	<div id="fixedcolumnPick3" class="px-1"></div>
																</div>
															</div>
														</div>
													</div>
													<div id="fixedcolumnPickDialogButton"></div>
													<div id="fixedresultDownloadButtonContainer"></div>
													<span id="fixedmanageButton" class=""></span>
													<span id="fixedremoveButtonDiv" class=""></span>
													<div id="fixedresultBMMapLinkContainer"></div>
													<div id="fixedselectModeContainer" class="ml-3" style="display: none;" >
														<script>
															function fixedchangeSelectMode(){
																var selmode = $("singlecell").val();
																$("##fixedsearchResultsGrid").jqxGrid({selectionmode: selmode});
																if (selmode=="singlecell") { 
																	$("##fixedsearchResultsGrid").jqxGrid({enableBrowserSelection: true});
																} else {
																	$("##fixedsearchResultsGrid").jqxGrid({enableBrowserSelection: false});
																}
															};
														</script>

														<label class="data-entry-label d-inline w-auto mt-1" for="fixedselectMode">Grid Select:</label>
														<select class="data-entry-select d-inline w-auto mt-1" id="fixedselectMode" onChange="fixedchangeSelectMode();">
															<cfif defaultSelectionMode EQ 'singlecell'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option selected value="singlecell">Single Cell</option>
															<cfif defaultSelectionMode EQ 'singlerow'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="singlerow">Single Row</option>
															<cfif defaultSelectionMode EQ 'multiplerowsextended'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplerowsextended">Multiple Rows (click, drag, release)</option>
															<cfif defaultSelectionMode EQ 'multiplecellsadvanced'><cfset selected="selected"><cfelse><cfset selected=""></cfif>
															<option #selected# value="multiplecellsadvanced">Multiple Cells (click, drag, release)</option>
														</select>
													</div>
												
													<output id="fixedactionFeedback" class="btn btn-xs btn-transparent my-2 px-2 mx-1 pt-1 border-0"></output>
												</div>
												<!--- TODO: Figure out how to make this sticky row work on the column header row --->
												<div class="row mx-0 mt-0"> 
													
													<!--- Grid Related code is below along with search handlers --->
													<div id="fixedsearchResultsGrid" class="jqxGrid" role="table" aria-label="Search Results Table">
													</div>
													<div id="fixedPostGridControls" class="p-1 d-none d-md-block" style="display: none;" >
														<!--- a mouse wheel toggle could go here --->
													</div>
													
												</div>
											</div>
										</div>
									</div>
								</div>
<div id="testGrid"></div>
<script>
//var data = [ { name: "A", age: 1 }, { name: "B", age: 2 } ];
//var source = { datatype: "array", localdata: data };
//var dataAdapter = new $.jqx.dataAdapter(source);

	$("##fixedsearchResultsGrid").jqxGrid({
					width: '100%',
					autoheight: 'true',
					source: dataAdapter,
					filterable: false,
					sortable: true,
					pageable: true,
					editable: false,
					virtualmode: true,
					enablemousewheel: #session.gridenablemousewheel#,
					keyboardnavigation: true,
					pagesize: '#session.specimens_pagesize#',
					pagesizeoptions: ['5','10','25','50','100','500'], // fixed list regardless of actual result set size, dynamic reset goes into infinite loop.
					showaggregates: true,
					columnsresize: true,
					autoshowfiltericon: true,
					autoshowcolumnsmenubutton: false,
					autoshowloadelement: false,  // overlay acts as load element for form+results
					columnsreorder: true,
					groupable: true,
					selectionmode: 'singlecell',
					//enablebrowserselection: #defaultenablebrowserselection#,
					altrows: true,
					showtoolbar: false,
//					ready: function () {
//						$("##fixedsearchResultsGrid").jqxGrid('selectrow', 0);
//						$("##fixedsearchResultsGrid").jqxGrid('focus');
//					},
					rendergridrows: function () {
						return dataAdapter.records;
					},
					columns: [
						<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
							<cfif isdefined("session.killRow") AND session.killRow GT 0>
								<cfset removerow = "{text: 'Remove', datafield: 'RemoveRow', cellsrenderer:removeFixedCellRenderer, width: 40, cellclassname: fixedcellclass, hidable:false, hidden: false },">
								#removerow#
							</cfif>
						</cfif>
						<cfset lastrow ="">
						<cfloop query="getFieldMetadata">
							<cfset cellrenderer = "">
							<cfif len(getFieldMetadata.cellsrenderer) GT 0>
								<cfif left(getFieldMetadata.cellsrenderer,1) EQ "_"> 
									<cfset cellrenderer = " cellsrenderer:fixed#getFieldMetadata.cellsrenderer#,">
								<cfelse>
									<cfset cellrenderer = " cellsrenderer:#getFieldMetadata.cellsrenderer#,">
								</cfif>
							</cfif> 
							<cfif ucase(data_type) EQ 'DATE'>
								<cfset filtertype = " filtertype: 'date',">
							<cfelse>
								<cfset filtertype = "">
							</cfif>
							<cfif ucase(column_name) EQ lastcolumn>
								<!--- last column, no trailing comma --->
								<cfset lastrow = "{text: '#label#', datafield: '#ucase(column_name)#',#filtertype##cellrenderer# width: #width#, cellclassname: fixedcellclass, hidable:#hideable#, hidden: getColHidProp('#ucase(column_name)#', #hidden#), editable: false }">
							<cfelse> 
								{text: '#label#', datafield: '#ucase(column_name)#',#filtertype##cellrenderer# width: #width#, cellclassname: fixedcellclass, hidable:#hideable#, hidden: getColHidProp('#ucase(column_name)#', #hidden#) },
							</cfif>
						</cfloop>
						#lastrow#
					],
					
					rowdetails: true,
					rowdetailstemplate: {
						rowdetails: "<div style='margin: 10px;'>Row Details</div>",
						rowdetailsheight:  1 // row details will be placed in popup dialog
					},
					initrowdetails: initRowDetails
				});

				<cfif isdefined("session.username") and len(#session.username#) gt 0>
					$('##fixedsearchResultsGrid').jqxGrid().on("columnreordered", function (event) { 
						columnOrderChanged('fixedsearchResultsGrid'); 
					}); 
				</cfif>
				
				$("##fixedsearchResultsGrid").on("bindingcomplete", function(event) {
					
					
						$("##fixedsearchResultsGrid").attr('tabindex', 0);

						// Set all interactive descendants to non-tabbable
						$("##fixedsearchResultsGrid").find('a, button, input').attr('tabindex', -1);

						var columns = $("##fixedsearchResultsGrid").jqxGrid('columns').records;
						if (columns && columns.length > 0) {
							$("##fixedsearchResultsGrid").jqxGrid('selectcell', 0, columns[0].datafield);
						}
						$("##fixedsearchResultsGrid").focus();

						// The rest of your existing logic...
						$("##fixedsearchResultsGrid").on('focusin', function(event) {
							// Check if any cell is already selected
							var selection = $("##fixedsearchResultsGrid").jqxGrid('getselectedcell');
							if (!selection || typeof selection.rowindex === "undefined" || !selection.datafield) {
								var columns = $("##fixedsearchResultsGrid").jqxGrid('columns').records;
								if (columns && columns.length > 0) {
									$("##fixedsearchResultsGrid").jqxGrid('selectcell', 0, columns[0].datafield);
								}
							}
						});
					
					<cfif NOT isDefined("session.gridscrolltotop") OR session.gridscrolltotop EQ "true">
						if (document <= 900){
							$(document).scrollTop(200);
						} else {
							$(document).scrollTop(480);
						}
					</cfif>
			
					// add a link out to this search, serializing the form as http get parameters
					$('##fixedresultLink').html('<a href="/Specimens.cfm?execute=true&' + $('##fixedSearchForm :input').filter(function(index,element){ return $(element).val()!='';}).not(".excludeFromLink").serialize() + '">Link to this search</a>');
					$('##fixedshowhide').html('<button class="my-2 border rounded" title="hide search form" onclick=" toggleSearchForm(\'fixed\'); "><i id="fixedSearchFormToggleIcon" class="fas fa-eye-slash"></i></button>');
					if (fixedSearchLoaded==0) { 
						try { 
							gridLoaded('fixedsearchResultsGrid','occurrence record','fixed');
						} catch (e) { 
							console.log(e);
							messageDialog("Error in gridLoaded handler:" + e.message,"Error in gridLoaded");
						}
						fixedSearchLoaded = 1;
						loadColumnOrder('fixedsearchResultsGrid');
					}
					<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
						$('##fixedmanageButton').html('<a href="specimens/manageSpecimens.cfm?result_id='+$('##result_id_fixedSearch').val()+'" target="_blank" class="btn btn-xs btn-secondary px-2 my-2 mx-1" >Manage</a>');
					<cfelse>
						$('##fixedmanageButton').html('');
					</cfif>
					<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
						<cfif isdefined("session.killRow") AND session.killRow EQ 2>
							<cfif isdefined("session.roles") and listfindnocase(session.roles,"manage_specimens")>
								$('##fixedremoveButtonDiv').html('<button id="fixedremoveButton" class="btn btn-xs btn-secondary px-2 my-2 mx-1 disabled" disabled onclick="removeFixedSelectedRows(); " >Remove Checked</a>');
							<cfelse>
								$('##fixedremoveButtonDiv').html('');
							</cfif>
						</cfif>
					</cfif>
					pageLoaded('fixedsearchResultsGrid','occurrence record','fixed');
					<cfif isDefined("session.specimens_pin_guid") AND session.specimens_pin_guid EQ 1> 
						console.log(#session.specimens_pin_guid#);
						setPinColumnState('fixedsearchResultsGrid','GUID',true);
					</cfif>
				});
				$('##fixedsearchResultsGrid').on('rowexpand', function (event) {
					//  Create a content div, add it to the detail row, and make it into a dialog.
					var args = event.args;
					var rowIndex = args.rowindex;
					var datarecord = args.owner.source.records[rowIndex];
					console.log(rowIndex);
					createSpecimenRowDetailsDialog('fixedsearchResultsGrid','fixedrowDetailsTarget',datarecord,rowIndex);
				});
				$('##fixedsearchResultsGrid').on('rowcollapse', function (event) {
					// remove the dialog holding the row details
					var args = event.args;
					var rowIndex = args.rowindex;
					$("##fixedsearchResultsGridRowDetailsDialog" + rowIndex ).dialog("destroy");
				});
				// display selected row index.
				$("##fixedsearchResultsGrid").on('rowselect', function (event) {
					$("##fixedselectrowindex").text(event.args.rowindex);
				});
				// display unselected row index.
				$("##fixedsearchResultsGrid").on('rowunselect', function (event) {
					$("##fixedunselectrowindex").text(event.args.rowindex);
				});
			});
</script>

							

<cfinclude template="/shared/_footer.cfm">
